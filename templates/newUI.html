<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stock Market Insights Bot</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f3f4f6;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .main-container {
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .market-selector {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .market-selector h2 {
      margin: 0 0 15px 0;
      color: #1f2937;
    }

    .market-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
    }

    .market-button {
      padding: 10px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .market-button:hover {
      border-color: #10a37f;
      background: #f0fdf4;
    }

    .market-button.active {
      border-color: #10a37f;
      background: #10a37f;
      color: white;
    }

    .chat-container {
      width: 100%;
      height: 70vh;
      background-color: #ffffff;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .chat-header {
      background-color: #10a37f;
      color: white;
      padding: 20px;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
    }

    .chat-box {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      background-color: #f9fafb;
    }

    .message {
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 12px;
      max-width: 80%;
      line-height: 1.5;
      font-size: 14px;
      word-wrap: break-word;
    }

    .user-message {
      background-color: #dcfce7;
      align-self: flex-end;
      text-align: right;
      margin-left: auto;
    }

    .bot-message {
      background-color: #e0f2fe;
      align-self: flex-start;
      text-align: left;
      margin-right: auto;
    }

    .input-container {
      display: flex;
      padding: 16px;
      background-color: #ffffff;
      border-top: 1px solid #e5e7eb;
    }

    .input-container input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 20px;
      font-size: 14px;
      outline: none;
    }

    .input-container button {
      padding: 12px 20px;
      margin-left: 12px;
      background-color: #10a37f;
      border: none;
      color: white;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
    }

    .chat-box::-webkit-scrollbar {
      width: 6px;
    }

    .chat-box::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 10px;
    }

    .price-up {
      color: #22c55e;
    }

    .price-down {
      color: #ef4444;
    }
  </style>
</head>
<body>

<div class="main-container">
  <div class="market-selector">
    <h2>Select Market</h2>
    <div class="market-buttons">
      <button class="market-button active" data-market="IN">ğŸ‡®ğŸ‡³ India</button>
      <button class="market-button" data-market="US">ğŸ‡ºğŸ‡¸ USA</button>
      <button class="market-button" data-market="UK">ğŸ‡¬ğŸ‡§ UK</button>
      <button class="market-button" data-market="JP">ğŸ‡¯ğŸ‡µ Japan</button>
      <button class="market-button" data-market="CN">ğŸ‡¨ğŸ‡³ China</button>
      <button class="market-button" data-market="DE">ğŸ‡©ğŸ‡ª Germany</button>
    </div>
  </div>

  <div class="chat-container">
    <div class="chat-header">ğŸ“ˆ Stock Market Insights Bot</div>

    <div class="chat-box" id="chat-box">
      <div class="message bot-message">
        Welcome to Global Stock Market Insights! You can:
        <br>ğŸ“ˆ Search for any company worldwide
        <br>ğŸ¢ Use company names or stock symbols
        <br>ğŸ’¬ Ask questions about stocks and markets
        <br><br>Examples:
        <br>- "Reliance"
        <br>- "TCS"
        <br>- "Infosys"
        <br>- "HDFC"
      </div>
    </div>

    <div class="input-container">
      <input type="text" id="userInput" placeholder="Search for any company (e.g., Reliance, TCS, Infosys)..." />
      <button onclick="handleUserInput()">Search</button>
    </div>
  </div>
</div>

<script>
  let currentMarket = 'IN'; // Default to Indian market

  // Handle market selection
  document.querySelectorAll('.market-button').forEach(button => {
    button.addEventListener('click', () => {
      document.querySelectorAll('.market-button').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      currentMarket = button.dataset.market;
      // Clear chat and show new welcome message
      document.getElementById('chat-box').innerHTML = '';
      showWelcomeMessage();
    });
  });

  function showWelcomeMessage() {
    const examples = {
      'IN': ['Reliance', 'TCS', 'Infosys', 'HDFC'],
      'US': ['Apple', 'Microsoft', 'Tesla', 'Amazon'],
      'UK': ['HSBC', 'BP', 'Vodafone', 'Barclays'],
      'JP': ['Toyota', 'Sony', 'Honda', 'Nintendo'],
      'CN': ['Alibaba', 'Tencent', 'Baidu', 'JD.com'],
      'DE': ['Siemens', 'Volkswagen', 'BMW', 'SAP']
    };

    const message = `
      Welcome to ${getCountryName(currentMarket)} Stock Market Insights! You can:
      <br>ğŸ“ˆ Search for any company in ${getCountryName(currentMarket)}
      <br>ğŸ¢ Use company names or stock symbols
      <br>ğŸ’¬ Ask questions about stocks and markets
      <br><br>Examples:
      <br>- "${examples[currentMarket][0]}"
      <br>- "${examples[currentMarket][1]}"
      <br>- "${examples[currentMarket][2]}"
      <br>- "${examples[currentMarket][3]}"
    `;
    appendMessage(message, 'bot-message');
  }

  function getCountryName(code) {
    const countries = {
      'IN': 'Indian',
      'US': 'US',
      'UK': 'UK',
      'JP': 'Japanese',
      'CN': 'Chinese',
      'DE': 'German'
    };
    return countries[code];
  }

  function appendMessage(message, sender) {
    const chatBox = document.getElementById('chat-box');
    const msg = document.createElement('div');
    msg.className = `message ${sender}`;
    msg.innerHTML = message;
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function handleUserInput() {
    const inputField = document.getElementById('userInput');
    const userInput = inputField.value.trim();
    if (!userInput) return;

    appendMessage(userInput, 'user-message');
    inputField.value = '';
    appendMessage("Searching...", 'bot-message');

    fetch('/get_stock_data', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        symbol: userInput,
        market: currentMarket
      })
    })
      .then(res => res.json())
      .then(data => {
        const lastBotMsg = document.querySelector('.bot-message:last-child');
        lastBotMsg.remove();

        if (data.error) {
          appendMessage(`Error: ${data.error}`, 'bot-message');
        } else {
          const changeClass = data.change >= 0 ? 'price-up' : 'price-down';
          const changeEmoji = data.change >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
          const reply = `
ğŸ“Š ${data.symbol}
ğŸ’° Current Price: â‚¹${data.current}
${changeEmoji} Change: <span class="${changeClass}">â‚¹${data.change} (${data.percent_change}%)</span>
ğŸ“ˆ High: â‚¹${data.high}
ğŸ“‰ Low: â‚¹${data.low}
ğŸŒ… Open: â‚¹${data.open}
ğŸŒ™ Previous Close: â‚¹${data.previous_close}`;
          appendMessage(reply, 'bot-message');
        }
      })
      .catch(() => {
        appendMessage("Sorry, couldn't find that company. Try another name or symbol.", 'bot-message');
      });
  }

  // Show initial welcome message
  showWelcomeMessage();
</script>

</body>
</html>
